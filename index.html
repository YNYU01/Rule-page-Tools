<!DOCTYPE html>
  <html lang="en">
  <head>
      <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
      <meta charset="UTF-8">
      <title>Rule-page Tools</title>
      
      <style>
      :root{
           --color5:hsl(0,0%,60%);
           --color1:hsl(0,0%,52%);
           --color2:hsl(0,0%,72%);
           --color3:hsl(0,0%,100%);
           --color4:hsl(0,0%,85%);
           --switch1:#707070;
           --switch2:#ffffff;
           --switch3:#000000;
           --switch4:#e3ca26;
           }

      .color-5{
        background:var(--color5)
      }

      .color-1{
        background:var(--color1)
      }

      .color-2{
        background:var(--color2)
      }

      .color-3{
        background:var(--color3)
      }

      .color-4{
        background:var(--color4)
      }

      .color-box{
        width: 26px;
        height: 26px;
        border: 1px solid black;
        border-radius: 4px;
      }
      .text-box{
        width: 40px;
        height: 10px;
      }

      .text-1{
        font-size: 12px;
        text-align: center;
      }

      .bg-box{
        width: 375px; height: 650px;
        background:var(--color5)
      }

      .bg-img{
        background-image: url('https://raw.githubusercontent.com/YNYU01/Mini-Act-Tools/main/img/bg_%E8%A7%84%E5%88%99%E9%A1%B5.png');
        background-repeat: no-repeat;
        background-size: contain;
        background-position: top;
        overflow: hidden;
      }

      .button {
        text-align: center;
        line-height: 8px;        
        width:auto; 
        min-width: 80px;
        height:26px; 
        border-radius: 4px;
        background-color: rgb(92, 141, 190);
        color: #ffffff;
        padding: 10px 20px;
        border: none;
        cursor: pointer;
      }

      .button:hover {
        background-color: rgb(63, 113, 164);
      }

      .button2 {
        text-align: center;
        line-height: 8px;
        display: flex;
        align-items: center;
        position: relative;       
        height:26px; 
        border-radius: 4px;
        background-color: rgb(218, 218, 218);
        color: rgb(146, 146, 146);
        padding: 10px 20px;
        border: none;
        cursor: pointer;
      }

      .button2:hover {
        background-color: rgb(120, 120, 120);
        color: #505050;
      }

      .button3 {
        text-align: center;
        line-height: 8px;
        display: flex;
        align-items: center;
        position: relative;       
        height:26px; 
        border-radius: 4px;
        background-color: rgb(192, 192, 192);
        color: rgb(0, 0, 0);
        padding: 10px 20px;
        border: none;
        cursor: pointer;
      }

      .button3:hover {
        background-color: rgb(63, 113, 164);
        color: #ffffff;
      }

      .tips1{
        position: relative;
        display: inline-block;
        cursor: pointer;
      }


      .tips1 .tips1text{
        visibility: hidden;
        width: 240px;
        background-color: #000000d0;
        color: #ffffffac;
        text-align: left;
        border-radius: 6px;
        padding: 5px;
        position: absolute;
        z-index: 1;
        top: 30px;
        left: 30%;
        transform: translateX(-20%);
        opacity: 1;
        transition: opacity 0.3s;
      }

      .tips1{
        position: relative;
        display: inline-block;
        cursor: pointer;
      }


      .tips1:hover .tips1text{
        visibility: visible;
        opacity: 1;
      }

      .tips2{
        position: relative;
        display: inline-block;
        cursor: pointer;
      }

      .tips2 .tips2text{
        visibility: hidden;
        width: 120px;
        background-color: #000000d0;
        color: #ffffffac;
        text-align: left;
        border-radius: 6px;
        padding: 5px;
        position: absolute;
        z-index: 1;
        top: 30px; 
        transform: translateX(-80%);
        opacity: 1;
        transition: opacity 0.3s;
      }

      .tips2:hover .tips2text{
        visibility: visible;
        opacity: 1;
      }

      .tips4 .tips4text{
        visibility: hidden;
        width:80px;
        background-color: #000000d0;
        color: #ffffffac;
        text-align: center;
        border-radius: 6px;
        padding: 5px;
        position: absolute;
        z-index: 1;
        top: 30px; 
        transform: translateX(-30%);
        opacity: 1;
        transition: opacity 0.3s;
      }

      .tips4:hover .tips4text{
        visibility: visible;
        opacity: 1;
      }

      .tips3{
        padding: 10px;
        background-color: #000000ba;
        color: #fff; 
        z-index: 1;
        bottom: 50%; 
        position: absolute;
        font-size: 12px;
        border-radius: 10px; 
      }

      .theme-switch {
        position: absolute;
        display: inline-block;
        width: 32px;
        height: 14px;
        background-color:var(--switch1);
        border-radius: 17px;
        margin-top: 0px;
      }

      .theme-switch::before {        
        content: "";
        position: absolute;
        width: 10px;
        height: 10px;
        border-radius: 50%;
        background-color: var(--switch2);
        top: 2px;
        left: 2px;
        transition: transform 0.3s;
      }

      .safa-switch {
        position: absolute;
        display: inline-block;
        color:var(--switch3);
        background-color: var(--switch4); 
        border-radius:0px 4px 4px 0px;
        
      }

      

      input[type="checkbox"] {
        display: none;
      }

      input[type="checkbox"]:checked + .theme-switch::before {
        transform: translateX(18px);
      }

      input[type="checkbox"]:checked + .safa-switch::before {
        transform: translatey(10px);
      }

      @keyframes tipsPickup {
        0%{
          opacity: 0;
          transform: translatey(50%);
        }
        30%{
          opacity: 1;
          transform: translatey(0);
        }
        100%{
          opacity: 1;
        }
        
      }

      </style>
  </head>
  <body style="font-family: Source Han Sans CN; display: flex; justify-content: center; position: relative;">
      <div id="pickertips" class="tips3" style="display: none;">当前颜色较亮,建议使用暗字色主题~</div>
      <div style="width: 400px; height: 850px; background-color: #eeeff3; border-radius: 10px;display: flex;flex-direction: column;justify-content: left;align-items: center;position: relative;">
        
        <!--说明区-->
        <div style=" width: 400px; height: 180px; top: 10px;  " >
            <div style="display: flex;position: relative; justify-content: center; align-items: center;">
              <div class="tips1"  style=" display: flex; justify-content: center; align-items: center; text-align: center; font-size: 24px;  font-weight: 700; color:#444">
                规则页模板2.4 <span class="text-1" style="height: 28px;color: #824ab0; transform: skewX(-18deg);">Bata</span> &nbsp;
                <span style="width: 16px;height: 16px; border:2px solid #a3a3a3; border-radius: 50%;display: flex; justify-content: center;align-items: center; margin-top: -2px; color: #a3a3a3; font-weight: 500;font-size: 14px; "> ? </span>
                <span class="tips1text" style="font-size: 10px; font-weight: 300;">1.通过本地文件传背景图（自动提色）<br>2.提色微调/选择合适的主题色；<br>3.导出效果图，并复制色号修改模板的style；<br>或创建svg，复制到Figma/Matergo中（bate） </span>
              </div>
              <!--主题开关-->
              <div style="width: 52px; height: 14px; right:0px; position: absolute;">
                <input type="checkbox" id="themeSwitch"> </input>
                <label for="themeSwitch" class="theme-switch">
                </label>
              </div>
            </div>
            
          <div id="tips1" style="width: 400px; height: 150px;transform: scale(0.9); transform-origin: top center;  position: relative; border-radius: 4px; background-color: #d3d7de; display: block;" >
            <div style="position: relative; text-align: left;  transform: skewX(-10deg); margin-left: 10px;  font-size: 10px; font-weight: 500; color:#898c96;" >
              *当前使用
              <span style="color:#5189d7">亮字色</span>主题
            </div>
            <div style="display: flex;">
              <div style=" position: relative; text-align: left; margin-left: 10px;  font-size: 12px;  font-weight: 300; color:#1e3d63 " >
                校正:S = [(s/10 - (s/100 + 1)^3) * (s/60 + 1)]*10 <span style="color: #898c96;"> // 超出63则衰减 </span> <br>
                校正:L = [(l/10 - (l/100 + 1)^3) * (l/60 + 3)]*10 <span style="color: #898c96;">// 低于20&超出83则衰减 </span> <br>
                color0:&nbsp;<span style="-webkit-text-stroke:1px #1e3d63; color: var(--color5);">■</span> h , S , L  <span style="color: #898c96;"> （主题色校正后）// 底框背景色、背景图拉伸色</span><br>
                color1:&nbsp;<span style="-webkit-text-stroke:1px #1e3d63; color: var(--color1);">■</span> h , S*1.13 , L-8  <span style="color: #898c96;"> // 主标题底框、表头背景色、表格线框</span><br>
                color2:&nbsp;<span style="-webkit-text-stroke:1px #1e3d63; color: var(--color2);">■</span> h , S , L+12  <span style="color: #898c96;"> // 表格背景色、奖励icon背景色</span><br>
                color3:&nbsp;<span style="-webkit-text-stroke:1px #1e3d63; color: var(--color3);">■</span> h , S , L+50  <span style="color: #898c96;"> // 主标题字色、正文字色、奖励icon字色</span><br>
                color4:&nbsp;<span style="-webkit-text-stroke:1px #1e3d63; color: var(--color4);">■</span> h , S , L+26 &nbsp; <span style="color: #898c96;"> // 次要字色、分点标识、底框描边</span>           
              </div>            
            </div>
          </div>

          <div id="tips2" style="width: 400px; height: 150px;transform: scale(0.9); transform-origin: top center;  position: relative; border-radius: 4px; background-color: #d3d7de; display: none;" >
            <div style="position: relative; text-align: left;  transform: skewX(-10deg); margin-left: 10px;  font-size: 10px; font-weight: 500; color:#898c96;" >
              *当前使用
              <span style="color:#824ab0">暗字色</span>主题
            </div>
            <div style="display: flex;">             
              <div style=" position: relative; text-align: left; margin-left: 10px;  font-size: 12px;  font-weight: 300; color:#1e3d63 " >
                校正:S = [(s/10 - (s/100 + 1)^3) * (s/60 + 1)]*10 <span style="color: #898c96;"> // 超出63则衰减 </span> <br>
                校正:L = [(l/10 - (l/100 + 1)^3) * (l/60 + <span style="color: #cc243a;">4</span>)]*10 <span style="color: #898c96;">// 低于30&超出93则衰减 </span> <br>
                color0:&nbsp;<span style="-webkit-text-stroke:1px #1e3d63; color: var(--color5);">■</span> h , S , L  <span style="color: #898c96;"> （主题色校正后）// 底框背景色、背景图拉伸色</span><br>
                color1:&nbsp;<span style="-webkit-text-stroke:1px #1e3d63; color: var(--color1);">■</span> h , S*1.13 , L-6  <span style="color: #898c96;"> // 主标题底框、表头背景色、表格线框</span><br>
                color2:&nbsp;<span style="-webkit-text-stroke:1px #1e3d63; color: var(--color2);">■</span> h , S , L+8  <span style="color: #898c96;"> // 表格背景色、奖励icon背景色</span><br>
                color3:&nbsp;<span style="-webkit-text-stroke:1px #1e3d63; color: var(--color3);">■</span> h , S , L-34  <span style="color: #898c96;"> // 主标题字色、正文字色、奖励icon字色</span><br>
                color4:&nbsp;<span style="-webkit-text-stroke:1px #1e3d63; color: var(--color4);">■</span> h , S , L-24 &nbsp; <span style="color: #898c96;"> // 次要字色、分点标识、底框描边</span>            
              </div>            
            </div>
          </div>

        </div>
        <!--导出范围-->
        <div style="width: 375px; height: 600px;margin-bottom: -150px; display: flex;flex-direction: column;justify-content: left;align-items: center;position: relative; ">
          <div id="imgs" style="width: 375px; height: 600px; background-size:100%; transform: scale(0.75); transform-origin: top center; display: none;"></div>
          <div id="export-img" style=" width: 375px; height: 600px;  background:var(--color5); transform: scale(0.75); transform-origin: top center;" >
            <div id="bg-img" class="bg-img" style="width: 375px; height: 600px;top: 0px;left: 0px; position: absolute; z-index: 0;"></div>
            <div  style="width: 375px; height: 600px; ">

              <div style="width: 375px; height: 600px;">
                <div style="width: 375px; height: 600px; background: linear-gradient(to bottom, transparent 150px, var(--color5));top:0px; left: 0px; position: absolute;"></div>
                <div style="height:60px;"></div>
                <!--框内滚动-->
                <div style="width: 375px; display: flex; justify-content: center;">
                  <div style="width: 355px; height: 510px; position: relative; background: var(--color5); border-radius: 5px; border: 1px solid var(--color4);">                 
                    <!--一级标题-->
                    <div style="height: 20px;"></div>
                    <div style="width: 355px; height: 25px;display: flex; position: relative; justify-content: center; align-items: center;">                   
                      <div style="border-radius: 16px; padding: 0px 10px 0px 10px; position: relative; text-align: center; color: var(--color3); font-size: 16px;  font-weight: 700; background-color: var(--color1); ">规则说明</div>
                    </div>
                    <div style="height: 20px;"></div>
                    <!--二级标题1-->
                    <div style="width: 355px; height: 22.50px;margin-left: 8px; display: flex; position: relative;justify-content: left;align-items: center;">
                      <div style="width: 4.50px; height: 12px;position: relative; background: var(--color4); border-radius: 6px"></div>
                      <div style="margin-left: 10px; position: relative; color: var(--color4); font-size: 15px;  font-weight: 700;">做任务应援主播（每日重置）</div>
                    </div>
                    <!--表格-->
                    <div style="width: 355px; height: 142px;margin: 10px 0px 12px 0px; display: flex; position: relative;">
                      <div style="width: 325px; height: 140px; margin-left: 20px; position: relative;background:var(--color1);border: 1px solid var(--color1);  border-radius: 5px; overflow: hidden">
                        <div style="width: 326px; height: 35px;;display: flex; justify-content: center; align-items: center;">
                          <div style="width: 162px; height: 35px;color: var(--color3);font-size: 12px;text-align: center;display: flex;justify-content: center; align-items: center;">
                            任务
                          </div>
                          <div style="width: 162px; height: 35px;margin-left: 1px;color: var(--color3);font-size: 12px;text-align: center;display: flex;justify-content: center; align-items: center; ">
                            奖励
                          </div>
                        </div>
                        <div style="width: 325px; height: 35px;margin-top: 1px;display: flex; justify-content: left; align-items: center;">
                          <div style="width: 162px; height: 35px;background-color: var(--color2);color: var(--color3);font-size: 12px;text-align: center;display: flex;justify-content: center; align-items: center;">
                            任务名称名称
                          </div>
                          <div style="width: 162px; height: 35px;margin-left: 1px; background-color: var(--color2);color: var(--color3);font-size: 12px;text-align: center;display: flex;justify-content: center; align-items: center;">
                            奖励名称名称
                          </div>
                        </div>
                        <div style="width: 325px; height: 35px;margin-top: 1px;display: flex; justify-content: left; align-items: center;">
                          <div style="width: 162px; height: 35px;background-color: var(--color2);color: var(--color3);font-size: 12px;text-align: center;display: flex;justify-content: center; align-items: center;">
                            任务名称名称
                          </div>
                          <div style="width: 162px; height: 35px;margin-left: 1px; background-color: var(--color2);color: var(--color3);font-size: 12px;text-align: center;display: flex;justify-content: center; align-items: center;">
                            奖励名称名称
                          </div>
                        </div>
                        <div style="width: 325px; height: 35px;margin-top: 1px;display: flex; justify-content: left; align-items: center;">
                          <div style="width: 162px; height: 35px;background-color: var(--color2);color: var(--color3);font-size: 12px;text-align: center;display: flex;justify-content: center; align-items: center;">
                            任务名称名称
                          </div>
                          <div style="width: 162px; height: 35px;margin-left: 1px; background-color: var(--color2);color: var(--color3);font-size: 12px;text-align: center;display: flex;justify-content: center; align-items: center;">
                            奖励名称名称
                          </div>
                        </div>                     
                      </div>
                    </div>
                    <!--二级标题2-->
                    <div style="width: 355px; height: 22.50px;margin-left: 8px; display: flex; position: relative;justify-content: left;align-items: center;">
                      <div style="width: 4.50px; height: 12px;position: relative; background: var(--color4); border-radius: 6px"></div>
                      <div style="margin-left: 10px; position: relative; color: var(--color4); font-size: 15px;  font-weight: 700;">完成所有任务</div>
                    </div>
                    <!--示意段落-->
                    <div style="width: 355px; margin: 8px 0px 10px 0px; position: relative;justify-content: center;">
                    
                      <div style="width: 315.50px; margin-left: 8px;display: flex; position: relative; justify-content: left; align-items: center;">
                        <div style="width: 6px; height: 6px; position: relative; border-radius: 50%; border: 1px var(--color4) solid"></div>                     
                        <div style="margin-left: 10px; position: relative; color: var(--color3); font-size: 12px; font-weight: 400; ">
                          策划提供文案策划提供文案策划提供文案                      
                        </div>
                      </div>
                      <div style="width: 330px; margin-left: 8px;display: flex; position: relative; justify-content: left; align-items: center;">
                        <div style="width: 6px; height: 6px; position: relative; border-radius: 50%; border: 1px var(--color4) solid"></div>                     
                        <div style="margin-left: 10px; position: relative; color: var(--color3); font-size: 12px; font-weight: 400; ">
                          策划提供文案策划提供文案策划提供文案策划提供文案策划                  
                        </div>
                      </div>
                      <div style="width: 330px; margin-left: 8px;display: flex; position: relative; justify-content: left; align-items: center;">
                        <div style="width: 6px; height: 6px; "></div>                     
                        <div style="margin-left: 11px; position: relative; color: var(--color3); font-size: 12px; font-weight: 400; ">
                          提供文案策划提供文案                  
                        </div>
                      </div>
                      <div style="width: 330px; margin-left: 8px;display: flex; position: relative; justify-content: left; align-items: center;">
                        <div style="width: 6px; height: 6px; "></div>                     
                        <div style="margin-left: 11px; position: relative; color: var(--color4); font-size: 12px; font-weight: 400; ">
                          策划提供文案策划提供文案策划提供文案               
                        </div>
                      </div>
                      <div style="width: 330px; margin-left: 8px;display: flex; position: relative; justify-content: left; align-items: center;">
                        <div style="width: 6px; height: 6px; "></div>                     
                        <div style="margin-left: 11px; position: relative; color: var(--color4); font-size: 12px; font-weight: 400; ">
                          策划提供文案策划提供文案策划提供文案策划提供文案策划                 
                        </div>
                      </div>

                    </div>
                    <!--奖励icon模块-->
                    <div style="width: 355px; height: 104px;display: flex;  position: relative; justify-content: center; align-items: center;">
                      <div style="width: 80px; height: 104px;  position: relative; background:var(--color2); margin: 0px 13px 0px 13px; border-radius: 5px; overflow: hidden">
                        <div style="width: 80px; height: 24px; top: 80px; position: relative; background:var(--color1)">
                          <div style="top: 3px; position: relative; color: var(--color3); font-size: 12px;  font-weight: 400;text-align: center; ">千里传音×1</div>
                        </div>
                      </div>
                      <div style="width: 80px; height: 104px;  position: relative; background:var(--color2); margin: 0px 13px 0px 13px; border-radius: 5px; overflow: hidden">
                        <div style="width: 80px; height: 24px; top: 80px; position: relative; background:var(--color1)">
                          <div style="top: 3px; position: relative; color: var(--color3); font-size: 12px;  font-weight: 400;text-align: center; ">千里传音×1</div>
                        </div>
                      </div>
                      <div style="width: 80px; height: 104px;  position: relative; background:var(--color2); margin: 0px 13px 0px 13px; border-radius: 5px; overflow: hidden">
                        <div style="width: 80px; height: 24px; top: 80px; position: relative; background:var(--color1)">
                          <div style="top: 3px; position: relative; color: var(--color3); font-size: 12px;  font-weight: 400;text-align: center; ">千里传音×1</div>
                        </div>
                      </div>                   
                    </div>
                  </div>  
                </div>
              </div>             
            </div>
          </div>
          <!--input id="imgSVG" type="text" style="width:290px; height:18px; border-radius: 4px;"> </input-->
        </div>
        <!--链接提色>
        <div style="width: 375px; height: 30px;display: flex;align-items: center; margin-top: 4px;position: relative; ">
          <input type="text" 
                 id="imgurl" 
                 
                 value="https://cdn.discordapp.com/attachments/1093806222781730899/1218086493692624976/bg_6f83661.png?ex=66066273&is=65f3ed73&hm=8d5d46c1f963cbbff0d22f41685f91e634f0418e5fc5ecd74c458222575ea24d&"
                 style="width:240px; height:18px; border-radius: 4px; margin-left: 20px;">
          <button onclick="extractColor()" class="button2 tips4" style="right:0px; position: absolute; ">
            AI提色<span class="tips4text" style="font-size: 10px;">*仅支持链接,可将图片上传MJ，复制链接</span>
            
          </button>    
        </div-->
        <div style="width: 375px;height: auto; display: flex;flex-direction: column;justify-content: left;position: relative;">
          <div style="height: 20px; text-align: center;color: #a7a7a7;line-height: 1.5ch;">-------------------------------------------------------------------<br>
            <span style="font-size: 10px;user-select: none; ">SVG功能容易卡崩，慎用</span>
          </div>
          <div  style="font-size: 14px; margin-top: 8px;color: #777;"> [配置背景图]</div>
          <div style="display: flex; font-size: 14px;align-items: center;">
            本地：
            <input type="file" id="imageInput" style="margin-top: 4px;">
          </div>
          <div style="display: flex; font-size: 14px;align-items: center; display: none;">
            链接：
            <input type="text" id="imgurl"  style="width:300px; height:18px; border-radius: 4px;border:1px solid #727272; margin-top: 4px;">
          </div>
          <div style="display: flex; font-size: 14px;align-items: center;display: none;">
            <span style="letter-spacing: 0.1ch; ">SVG</span>：
            <input type="text" id="imgSVG" style="width:240px; height:18px; border-radius: 4px;border:1px solid #727272; margin-top: 4px; ">
            <button onclick="extractColor()" class="button2 tips4" style="right:0px; position: absolute; ">
              AI提色<span class="tips4text" style="font-size: 10px;">*仅支持svg提色</span>
            </button>
          </div>
          <div style="display: flex; font-size: 14px;align-items: center;">
            创建：
            <input type="text" id="imgSVG2" style="width:326px; height:18px; border-radius: 4px;border:1px solid #727272; margin-top: 4px; ">
          </div>
          
          <div  style="font-size: 14px;margin-top: 8px;color: #777;"> [配置颜色]</div>
          <div style=" display: flex; font-size: 14px;align-items: center; ">
            主题色：
            <input type="text" id="colorValue" value="#808080" style="width:60px; height:26px; border-radius: 4px; border:1px solid #727272; ">
            <div style="width: 51px; height: 26px; border:1px solid #727272; border-radius: 6px;">
              <input type="color" value="#808080" id="colorPicker" style="width: 30px; height:26px; border-radius: 4px 0px 0px 4px; border:1px solid #727272;" ><!--主题色选择-->
              <div class="tips2" style="position: absolute;">        
                <span class="tips2text" style="font-size: 10px; text-align: center;">关闭后可选择非安全色</span>
                <input type="checkbox" id="safaSwitch" ></input>
                <label for="safaSwitch" class="safa-switch" style="width: 14px; height: 19px;font-size: 10px; text-align: center; line-height: 10px;padding: 3px;border:1px solid #727272; box-shadow:0px 0px 4px #ffffff84 inset;  ">
                  SA<br>FA
                </label>
              </div>
            </div>
            <button  onclick="AIcolor()" class="button3" style="position: absolute; right: 0px;">AI提色</button>
          </div>
        </div>
        
        <!--导出图片-->
        <div style="width: 375px; height: auto; display: flex; margin-top: 20px;display: flex; position: relative;justify-content: right; align-items: center; ">
          <button  onclick="exportimg()" class="button" >导出</button>
          <button  onclick="copyimg()" class="button2" style="margin-left: 8px;">创建SVG</button>
          <!--<button onclick="location.reload()" class="button2">重置</button>-->
          <!--button onclick="reload()" class="button2">默认</button-->         
          <div class="text-1" style="margin-top: 8px; color: #a4a4a4; transform: skewX(-8deg); font-size: 8px;left:0px; position: absolute; text-align: left;">✦✦  2024.4.23 最近更新 <br> ·颜色校正公式 &nbsp; ·主文案彩色 &nbsp; ·色阶优化</div>
        </div>
        
        <div id="log" style="width: 400px; height: 20px; font-size: 12px; color: #972a37;"></div>
        <canvas id="canvas" style="display: none; "></canvas>
      </div> 
      
      
      


<script>


  themeChange()
  addUrl()
  addSvg()

  const log = document.getElementById('log');

  const colorPicker = document.getElementById('colorPicker');
  const root = document.documentElement;
  

  //颜色选择器同步换色
  colorPicker.addEventListener('input', function() {
    var tipsset = document.getElementById("pickertips");
    var picker = colorPicker.value ;
    var rgb = hexToRgb(picker);

    const r = parseInt(picker.slice(1, 3), 16);
    const g = parseInt(picker.slice(3, 5), 16);
    const b = parseInt(picker.slice(5, 7), 16);
    
    var max = Math.max(r,g,b)
    var min = Math.min(r,g,b)

    var num = (r/255 + (1.5 * g)/255 + (0.6 * b)/255) / (1 + 1.5 + 0.6)
    var l = num * 255 ;
    var s = (max - min)/max * 100;

    //安全模式
    var checkbox1 = document.getElementById("safaSwitch")
    if (checkbox1.checked){
      if (l>150){
        var checkbox = document.getElementById("themeSwitch");
        checkbox.checked = true;
        changeColor()
        updateColorValue()
        tipsTodark()
      }else {
        var checkbox = document.getElementById("themeSwitch");
        checkbox.checked = false;
        changeColor()
        updateColorValue()
        tipsTolight()
      }
      
    }else{
      //先判断明度，再判断饱和度
      if (l > 230){
        darktips2()
      }else if ( l < 50){
        lighttips2()
      }else if ( l <= 230 , l > 150 ){
          var checkbox = document.getElementById("themeSwitch");
          
          if (s >= 94){ 
          stips1()
          } else if (s <= 10){
            stips2()
          } else {
            checkbox.checked = true;
            changeColor()
            updateColorValue()
            tipsTodark()
          }
      }else {
          var checkbox = document.getElementById("themeSwitch");
          
          if (s >= 90){ 
            stips1()
          } else if (s <= 18){
            stips2()
          } else {
            checkbox.checked = false;
            changeColor()
            updateColorValue()
            tipsTolight()
          }
      }
    }

  });



//符合条件则换色
function changeColor(){
  var checkbox = document.getElementById("themeSwitch")
        if (checkbox.checked) {
        colordark();
      } else {
        colorlight();
      };
    }

//亮字色主题
function colorlight(){
  const color = colorPicker.value;
  const hsl = rgbToHsl(hexToRgb(color));
  
  var H = hsl.h;
  var S = hsl.s ;
  var L = hsl.l;
  //衰减运算
  var S1 = [(S/10 - Math.pow((S/100 + 1),3) ) * (S/60 + 1) + 1 ]*10;
  var L1 = [(L/10 - Math.pow((L/100 + 1),3) ) * (L/60 + 1) + 3 ]*10;

  //测试  
  log.innerHTML = S1 + "," + L1;

  root.style.setProperty('--color5', "hsl(" + H +","+ S1 + "%,"+ L1 +"%)");
  root.style.setProperty('--color1', "hsl(" + H +","+ (S1*1.13) + "%,"+ (L1 - 8) +"%)");
  root.style.setProperty('--color2', "hsl(" + H +","+ S1 + "%,"+ (L1 + 12) +"%)");
  root.style.setProperty('--color4', "hsl(" + H +","+ S1 + "%,"+ (L1 + 26) +"%)");
  root.style.setProperty('--color3', "hsl(" + H +","+ S1 + "%,"+ (L1 + 50) +"%)");
}
//暗字色主题
function colordark(){
  const color = colorPicker.value;
  const hsl = rgbToHsl(hexToRgb(color));
  var H = hsl.h;
  var S = hsl.s ;
  var L = hsl.l;
  //衰减运算
  var S1 = [(S/10 - Math.pow((S/100 + 1),3) ) * (S/60 + 1) + 1 ]*10;
  var L1 = [(L/10 - Math.pow((L/100 + 1),3) ) * (L/60 + 1) + 4 ]*10;

  //测试 
  log.innerHTML = S1 + "," + L1;

  root.style.setProperty('--color5', "hsl(" + H +","+ S1 + "%,"+ L1 +"%)");
  root.style.setProperty('--color1', "hsl(" + H +","+ (S1*1.1) + "%,"+ (L1 - 6) +"%)");
  root.style.setProperty('--color2', "hsl(" + H +","+ S1 + "%,"+ (L1 + 8) +"%)");
  root.style.setProperty('--color4', "hsl(" + H +","+ S1 + "%,"+ (L1 - 24) +"%)");
  root.style.setProperty('--color3', "hsl(" + H +","+ S1 + "%,"+ (L1 - 34) +"%)");
}

// HEX转RGB
function hexToRgb(hex) {
  const r = parseInt(hex.slice(1, 3), 16);
  const g = parseInt(hex.slice(3, 5), 16);
  const b = parseInt(hex.slice(5, 7), 16);
  
  return { r, g, b };
}

// RGB转HSL
function rgbToHsl(rgb) {
  const r = rgb.r / 255;
  const g = rgb.g / 255;
  const b = rgb.b / 255;
  
  const max = Math.max(r, g, b);
  const min = Math.min(r, g, b);
  
  let h, s, l = (max + min) / 2;
  
  if (max === min) {
    h = s = 0; // achromatic
  } else {
    const d = max - min;
    s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
    
    switch (max) {
      case r:
        h = (g - b) / d + (g < b ? 6 : 0);
        break;
      case g:
        h = (b - r) / d + 2;
        break;
      case b:
        h = (r - g) / d + 4;
        break;
    }
    
    h /= 6;
  }
  
  return { h: Math.round(h * 360), s: Math.round(s * 100), l: Math.round(l * 100) };
}

//RGB转HEX
function rgbToHex(r,g,b){
    var hex = "#" + ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1);
    return hex;
}

//显示色值
function updateColorValue() {
        var colorPicker = document.getElementById("colorPicker");
        var colorValue = document.getElementById("colorValue");
        colorValue.value = colorPicker.value;
    }

//上传背景图
  var uploadInput = document.getElementById('imageInput');
  var bgs = document.getElementById('bg-img');
  var file = uploadInput.files[0];

  //通过上传文件替换背景图
  uploadInput.addEventListener('change', function() {
    var file = this.files[0];
    const reader = new FileReader();

    reader.onload = function(e) {
      bgs.style.backgroundImage = `url(${e.target.result})`;   
      imgColor()
    };
    reader.readAsDataURL(file);

    

  });

  function AIcolor(){
    imgColor() 
    /*var link = document.createElement('a');
                link.href = canvas.toDataURL();
                link.download = 'screenshot.png';
                link.click();*/
}

//提取主色
  function imgColor() {
  html2canvas(document.getElementById("bg-img"),{scale: 1}).then(function(canvas) {
    var imageData = canvas.toDataURL("image/png");

    var img_url = imageData ;

    var img = new Image()
    img.src = img_url;
    img.crossOrigin = "anonymous"

      
    img.onload = function() {
      var canvas = document.getElementById('canvas')
      var ctx = canvas.getContext('2d')
      ctx.drawImage(img, 0, 0)
      img.style.display = 'none'

      var imgData = (ctx.getImageData(0, 0, img.width, img.height )).data;
      
      var r = imgData[0] ;
      var g = imgData[1] ;
      var b = imgData[2] ;
      var rgb = "rgb(" + (imgData[0]) + "," + (imgData[1]) + "," + (imgData[2]) + ")";
      
    

      var max = Math.max(r,g,b)
      var min = Math.min(r,g,b)
    
      var l = (r * 299 + g * 587 + b * 114)/1000;
      var s = (max - min)/max * 100;
    
      
      if ( l < 90){
        var r = imgData[0] + 30;
        var g = imgData[1] + 30;
        var b = imgData[2] + 30;
        var checkbox = document.getElementById("themeSwitch");
        checkbox.checked = false;
        lighttips()
      }else if (l > 180) {
        var r = imgData[0] - 30;
        var g = imgData[1] - 30;
        var b = imgData[2] - 30;
        var checkbox = document.getElementById("themeSwitch");
        checkbox.checked = true;
        darktips()
      }else {
        var r = imgData[0];
        var g = imgData[1];
        var b = imgData[2];
        var checkbox = document.getElementById("themeSwitch");
        checkbox.checked = false;
        lighttips()
      }
        
      
      var aicolor = document.getElementById("colorValue")
      var aicolor2 = document.getElementById("colorPicker")
      aicolor.value = rgbToHex(r,g,b)
      aicolor2.value = rgbToHex(r,g,b)
      var checkbox = document.getElementById("themeSwitch")
        if (checkbox.checked) {
        colordark();
      } else {
        colorlight();
      }
    }
    
    });
}



//提取主色(svg/链接)
function extractColor(){   
  addUrl()
  addSvg()
}

function addUrl() {
  var url = document.getElementById("imgurl");
  var urlvalue =url.value;
  var img_url = urlvalue;

  var img = new Image()
  img.src = img_url;
  img.crossOrigin = "anonymous"

    
  img.onload = function() {
    var canvas = document.getElementById('canvas')
    var ctx = canvas.getContext('2d')
    ctx.drawImage(img, 0, 0)
    img.style.display = 'none'

    var imgData = (ctx.getImageData(0, 0, img.width, img.height)).data;
    
    var r = imgData[0] ;
    var g = imgData[1] ;
    var b = imgData[2] ;
    var rgb = "rgb(" + (imgData[0]) + "," + (imgData[1]) + "," + (imgData[2]) + ")";
    
  

    var max = Math.max(r,g,b)
    var min = Math.min(r,g,b)
  
    var l = (r * 299 + g * 587 + b * 114)/1000;
    var s = (max - min)/max * 100;
  
    
    if ( l < 90){
      var r = imgData[0] + 30;
      var g = imgData[1] + 30;
      var b = imgData[2] + 30;
      var checkbox = document.getElementById("themeSwitch");
      checkbox.checked = false;
      lighttips()
    }else if (l > 180) {
      var r = imgData[0] - 30;
      var g = imgData[1] - 30;
      var b = imgData[2] - 30;
      var checkbox = document.getElementById("themeSwitch");
      checkbox.checked = true;
      darktips()
    }else {
      var r = imgData[0];
      var g = imgData[1];
      var b = imgData[2];
      var checkbox = document.getElementById("themeSwitch");
      checkbox.checked = false;
      lighttips()
    }
      
    
    var aicolor = document.getElementById("colorValue")
    var aicolor2 = document.getElementById("colorPicker")
    aicolor.value = rgbToHex(r,g,b)
    aicolor2.value = rgbToHex(r,g,b)
    var checkbox = document.getElementById("themeSwitch")
      if (checkbox.checked) {
      colordark();
    } else {
      colorlight();
    }
  }
  

}

function addSvg() {
  var url = document.getElementById("imgSVG");
  var svg_url = url.value;

  var img = new Image()
  img.src = "data:image/svg+xml," + encodeURIComponent(svg_url);
  img.crossOrigin = "anonymous"

    
  img.onload = function() {
    var canvas = document.getElementById('canvas')
    var ctx = canvas.getContext('2d')
    ctx.drawImage(img, 0, 0)
    img.style.display = 'none'

    var imgData = (ctx.getImageData(0, 0, img.width, img.height)).data;
    
    var r = imgData[0] ;
    var g = imgData[1] ;
    var b = imgData[2] ;
    var rgb = "rgb(" + (imgData[0]) + "," + (imgData[1]) + "," + (imgData[2]) + ")";
    
  

    var max = Math.max(r,g,b)
    var min = Math.min(r,g,b)
  
    var num = (r/255 + (1.5 * g)/255 + (0.6 * b)/255) / (1 + 1.5 + 0.6)
    var l = num * 255 ;
    var s = (max - min)/max * 100;
  
    
    if ( l < 90){
      var r = imgData[0] + 30;
      var g = imgData[1] + 30;
      var b = imgData[2] + 30;
      var checkbox = document.getElementById("themeSwitch");
      checkbox.checked = false;
      lighttips()
    }else if (l > 180) {
      var r = imgData[0] - 30;
      var g = imgData[1] - 30;
      var b = imgData[2] - 30;
      var checkbox = document.getElementById("themeSwitch");
      checkbox.checked = true;
      darktips()
    }else {
      var r = imgData[0];
      var g = imgData[1];
      var b = imgData[2];
      var checkbox = document.getElementById("themeSwitch");
      checkbox.checked = false;
      lighttips()
    }
      
    
    var aicolor = document.getElementById("colorValue")
    var aicolor2 = document.getElementById("colorPicker")
    aicolor.value = rgbToHex(r,g,b)
    aicolor2.value = rgbToHex(r,g,b)
    var checkbox = document.getElementById("themeSwitch")
      if (checkbox.checked) {
      colordark();
    } else {
      colorlight();
    }
  }

  
}





function themeChange(){
  var themeSwitch = document.getElementById('themeSwitch');
  var safaSwitch = document.getElementById('safaSwitch');
  var tips1 = document.getElementById('tips1');
  var tips2 = document.getElementById('tips2');

  //主题切换
  themeSwitch.addEventListener('change', function() {
    if (this.checked) {
      document.documentElement.style.setProperty('--switch1','#c6c6c6');
      document.documentElement.style.setProperty('--switch2','#505050');
      tips1.style.display = "none";
      tips2.style.display = "block";
      colordark()
      darktips1()
    } else {
      document.documentElement.style.setProperty('--switch1','#707070');
      document.documentElement.style.setProperty('--switch2','#fff');
      tips1.style.display = "block";
      tips2.style.display = "none";
      colorlight()
      lighttips1()
    }
});



//安全模式（默认开启）
safaSwitch.addEventListener('change', function() {
  if (this.checked) {
    document.documentElement.style.setProperty('--switch3','#909090');
    document.documentElement.style.setProperty('--switch4','#c0c0c0');
  } else {
    document.documentElement.style.setProperty('--switch3','#000000');
    document.documentElement.style.setProperty('--switch4','#e3ca26');
  }
});

}

function tipsTodark(){
  var tips1 = document.getElementById('tips1');
  var tips2 = document.getElementById('tips2');
  tips1.style.display = "none";
  tips2.style.display = "block";
}

function tipsTolight(){
  var tips1 = document.getElementById('tips1');
  var tips2 = document.getElementById('tips2');
  tips1.style.display = "block";
  tips2.style.display = "none";
}


var clickCount = 0
//亮字色切换提示--有限次数
function lighttips1(){
  if (clickCount >= 4 ){return}
  var object = document.getElementById('pickertips');
    object.style.display = "block";
    object.style.animation = "tipsPickup 1s forwards";
    object.innerHTML = "当前使用【亮字色】模式~";
    setTimeout(function(){
      object.style.display = "none";      
    },1000);
    clickCount++;
}
//颜色过暗提示
function lighttips2(){
  var object = document.getElementById('pickertips');
    object.style.display = "block";
    object.style.animation = "tipsPickup 1s forwards";
    object.innerHTML = "！！所选颜色过暗！！";
    setTimeout(function(){
      object.style.display = "none";      
    },1000);
}
//亮字色模式生效提示
function lighttips(){
  var object = document.getElementById('pickertips');
    object.style.display = "block";
    object.style.animation = "tipsPickup 1s forwards";
    object.innerHTML = "当前使用【亮字色】模式~";
    setTimeout(function(){
      object.style.display = "none";      
    },1000);
    
}

//暗字色切换提示--有限次数
function darktips1(){
  if (clickCount >= 4 ){return}
  var object = document.getElementById('pickertips');
    object.style.display = "block";
    object.style.animation = "tipsPickup 1s forwards";
    object.innerHTML = "当前使用【暗字色】模式~";
    setTimeout(function(){
      object.style.display = "none";      
    },1000);
    clickCount++;
}
//颜色过亮提示
function darktips2(){
  var object = document.getElementById('pickertips');
    object.style.display = "block";
    object.style.animation = "tipsPickup 1s forwards";
    object.innerHTML = "！！所选颜色过亮！！";
    setTimeout(function(){
      object.style.display = "none";      
    },1000);
}
//暗字色模式生效提示
function darktips(){  
  var object = document.getElementById('pickertips');
    object.style.display = "block";
    object.style.animation = "tipsPickup 1s forwards";
    object.innerHTML = "当前使用【暗字色】模式~";
    setTimeout(function(){
      object.style.display = "none";      
    },1000);  
}

//颜色过纯提示
function stips1(){
  var object = document.getElementById('pickertips');
    object.style.display = "block";
    object.style.animation = "tipsPickup 1s forwards";
    object.innerHTML = "！！所选颜色过纯！！";
    setTimeout(function(){
      object.style.display = "none";      
    },1000);
}
//颜色过灰提示
function stips2(){
  var object = document.getElementById('pickertips');
    object.style.display = "block";
    object.style.animation = "tipsPickup 1s forwards";
    object.innerHTML = "！！所选颜色过灰！！";
    setTimeout(function(){
      object.style.display = "none";      
    },1000);
}


//导出预览图
function exportimg() {
            html2canvas(document.getElementById("export-img"),{scale: 2.66}).then(function(canvas) {
                var link = document.createElement('a');
                link.href = canvas.toDataURL();
                link.download = 'screenshot.png';
                link.click();
            });
        }


//复制到剪贴板、创建SVG
function copyimg() {
  var imgs = document.getElementById("imgs")
  var copys = document.getElementById("export-img")
  var imgSVG2 = document.getElementById("imgSVG2")

  html2canvas(document.getElementById("export-img"),{scale: 2.5}).then(function(canvas)  {    
    var imageData = canvas.toDataURL("image/png");

    var colorText = document.getElementById("colorPicker")
    var colorHEX = colorText.value

    var svgCode = "<svg xmlns='http://www.w3.org/2000/svg'xmlns:xlink='http://www.w3.org/1999/xlink' width='750' height='1235' viewBox='0 0 750 1235' > <image width='750' height='1200' x='0px' y='35px' xlink:href='" + imageData + "'/><text  fill='rgb(0, 0, 0)' font-size='24px' x='0px' y='18px'><tspan font-size='24px' fill='#000000'>" + colorHEX + "</tspan></text></svg>"

    imgSVG2.value = svgCode
    
  });
}



//输入链接替换背景图
const  imgurlInput = document.getElementById("imgurl");
const container = document.getElementById('bg-img');
const addSVG = document.getElementById('addSVG');

imgurlInput.oninput = function() {
  var imageUrl = imgurlInput.value;
  container.style.backgroundImage = 'url(' + imageUrl + ')';
  extractColor()
};

const  imgurlInput2 = document.getElementById("imgSVG")

imgurlInput2.oninput = function() {
  var imageData2 = imgurlInput2.value
  container.style.backgroundImage ="url('data:image/svg+xml,"  + encodeURIComponent(imageData2) + "') no-repeat"
  addSVG.innerHTML = imageData2
  extractColor()
}


</script>
  </body>
</html>
